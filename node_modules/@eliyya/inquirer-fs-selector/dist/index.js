import H from"path";import{createPrompt as Y,isBackspaceKey as Z,isDownKey as O,isEnterKey as ee,isUpKey as K,makeTheme as te,useKeypress as re,useMemo as S,usePagination as se,usePrefix as ie,useState as v}from"@inquirer/core";import c from"@inquirer/figures";import a from"chalk";import R from"fs";import x from"path";var P="\x1B[?25l";function M(e){return e.name==="escape"}function U(e){return e.name==="left"}function j(e){return e.name==="right"}function I(e){return e.endsWith(x.sep)?e:`${e}${x.sep}`}function X(e){return e.replace(/\x1B\[\d+m/g,"")}function B(e){return e.reduce((r,i)=>Math.max(r,X(i).length),0)}function k(e,r){return!r||r(e)}function _(e){return R.readdirSync(e,{withFileTypes:!0}).map(r=>({name:r.name,path:x.join(r.parentPath,r.name),isDir:r.isDirectory()}))}function A(e,r){return e.sort((i,m)=>i.isDisabled&&!m.isDisabled?1:!i.isDisabled&&m.isDisabled||i.isDir&&!m.isDir?-1:!i.isDir&&m.isDir?1:i.name.localeCompare(m.name)).filter(i=>!r||!i.isDisabled)}function d(e,r=!1){return!r||R.statSync(e).isDirectory()?e:x.dirname(e)}var ne={icon:{linePrefix:e=>e?`${c.lineUpRight}${c.line.repeat(2)} `:`${c.lineUpDownRight}${c.line.repeat(2)} `},style:{disabled:e=>a.dim(e),active:e=>a.cyan(e),cancelText:e=>a.red(e),emptyText:e=>a.red(e),directory:e=>a.yellow(e),file:e=>a.white(e),currentDir:e=>a.magenta(e),help:e=>a.white(e),key:e=>a.cyan(e)}},he=Y((e,r)=>{let{pageSize:i=10,hideNonMatch:m=!1,disabledLabel:q=" (not allowed)",allowCancel:C=!1,dir:F=!1}=e,z=e.cancelText||e.canceledLabel||"Canceled.",N=e.emptyText||e.noFilesFound||"Directory is empty.";e.theme?.style?.noFilesFound&&(e.theme.style.emptyText??=e.theme.style.noFilesFound);let[L,y]=v("pending"),s=te(ne,e.theme),$=ie({theme:s}),[g,b]=v(H.resolve(process.cwd(),e.path||".")),l=S(()=>{let t=_(g);for(let n of t)n.isDisabled=!n.isDir&&!k(n,e.match);return A(t,m)},[g]),f=S(()=>{let t=l.findIndex(p=>!p.isDisabled),n=l.findLastIndex(p=>!p.isDisabled);return t===-1?{first:0,last:0}:{first:t,last:n}},[l]),[h,D]=v(f.first),o=l[h];re((t,n)=>{if(ee(t))F?(y("done"),r(d(o.path))):o.isDir?(b(o.path),D(f.first)):o.isDisabled||(y("done"),r(d(o.path)));else if(j(t))o.isDir?(b(o.path),D(f.first)):o.isDisabled||(y("done"),r(d(o.path)));else if(K(t)||O(t)){if(n.clearLine(0),K(t)&&h!==f.first||O(t)&&h!==f.last){let p=K(t)?-1:1,u=h;do u=(u+p+l.length)%l.length;while(l[u].isDisabled);D(u)}}else Z(t)||U(t)?(b(H.resolve(g,"..")),D(f.first)):M(t)&&C&&(y("canceled"),r(d("canceled")))});let E=se({items:l,active:h,renderItem({item:t,index:n,isActive:p}){let u=n===l.length-1,w=s.icon.linePrefix(u);if(t.isDisabled)return s.style.disabled(`${w}${t.name}${q}`);let J=t.isDir?s.style.directory:s.style.file,Q=p?s.style.active:J,V=t.isDir?`${w}${I(t.name)}`:`${w}${t.name}`;return Q(V)},pageSize:i,loop:!1}),T=s.style.message(e.message);if(L==="canceled")return`${$} ${T} ${s.style.cancelText(z)}`;if(L==="done")return`${$} ${T} ${s.style.answer(o.path)}`;let W=s.style.currentDir(I(g)),G=S(()=>{let t=[`${s.style.key(c.arrowLeft+c.arrowUp+c.arrowDown+c.arrowRight)} navigate, ${s.style.key("<enter>")} ${F?"open directory":"select or open directory"}`,`${s.style.key("<backspace>")} go back${C?`, ${s.style.key("<esc>")} cancel`:""}`],n=B(t);return`${c.lineBold.repeat(n)}
${t.join(`
`)}`},[]);return`${$} ${T}
${W}
${E.length?E:s.style.emptyText(N)}
${G}${P}`});export{he as default};
